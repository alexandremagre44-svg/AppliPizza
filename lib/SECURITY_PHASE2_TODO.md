# SECURITY PHASE 2 - Firestore Rules TODO

**Priority:** ðŸ”´ CRITICAL - Must be completed before production deployment

## Missing Firestore Security Rules

The following 11 collections are currently used in the application but **DO NOT have security rules** in `firestore.rules`. This represents a **CRITICAL SECURITY VULNERABILITY**.

### Collections Requiring Rules

1. **`carts`**
   - Used by: App client
   - Purpose: Shopping cart data
   - Risk: Anyone can read/modify all carts
   - Required rule: User can only access their own cart

2. **`rewardTickets`**
   - Used by: Module loyalty
   - Purpose: Reward tickets for loyalty program
   - Risk: Users can create unlimited free tickets (fraud)
   - Required rule: Admin write, user read own tickets only

3. **`roulette_segments`**
   - Used by: Module roulette
   - Purpose: Roulette game configuration
   - Risk: Users can manipulate win probabilities
   - Required rule: Admin write, public read

4. **`roulette_history`**
   - Used by: Module roulette
   - Purpose: Game history
   - Risk: Users can read other users' game history
   - Required rule: User can only read own history

5. **`user_roulette_spins`**
   - Used by: Module roulette
   - Purpose: Spin counter per user
   - Risk: Users can reset their spin counter
   - Required rule: System write only, user read own

6. **`roulette_rate_limit`**
   - Used by: Module roulette
   - Purpose: Anti-abuse rate limiting
   - Risk: Users can bypass rate limiting
   - Required rule: System write only

7. **`order_rate_limit`**
   - Used by: Module ordering
   - Purpose: Anti-spam for orders
   - Risk: Order flooding possible
   - Required rule: System write only

8. **`user_popup_views`**
   - Used by: UI tracking
   - Purpose: Track popup views per user
   - Risk: Data pollution
   - Required rule: User can write own, read own

9. **`apps`**
   - Used by: SuperAdmin
   - Purpose: Multi-app configuration
   - Risk: Unauthorized access to all app configs
   - Required rule: Super admin only

10. **`restaurants`**
    - Used by: SuperAdmin + Client
    - Purpose: Restaurant data
    - Risk: Unauthorized access/modification of restaurant configs
    - Required rule: Admin write, public read basic info

11. **`users`**
    - Used by: SuperAdmin
    - Purpose: User management
    - Risk: User data theft, unauthorized modifications
    - Required rule: User can read/write own profile, admin full access

---

## Action Required

Add comprehensive security rules to `firestore.rules` for all 11 collections listed above.

**Estimated time:** 2 hours

**Blocking:** YES - Production deployment cannot proceed without these rules

---

**Generated by:** Phase 1 Cleanup  
**Date:** 2025-12-03  
**Reference:** docs/PHASE_1_CLEANUP_AUDIT.md Section 5.1
